<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="auteur" content="">
<link rel="icon" href="imagr/planet-earth.png">
<title>API openrouteserivce</title>
<!-- Bootstrap core CSS -->
<link href="assets/css/bootstrap.min.css" rel="stylesheet">
<!-- Fonts -->

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
<!-- Custom styles for this template -->
<link href="assets/css/mediumish.css" rel="stylesheet">
</head>
<body>
    <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/atom-one-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/python.min.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>

    </head>
    
    
    <body>

	
		
	</body>
<style>
	
</style>
<!-- Begin Nav
================================================== -->
<nav class="navbar navbar-toggleable-md navbar-light bg-white fixed-top mediumnavigation">
<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
<div class="container">
	<!-- Begin Logo -->
	<a class="navbar-brand" href="index.html">
	
	</a>
	<!-- End Logo -->
	<div class="collapse navbar-collapse" id="navbarsExampleDefault">
		<!-- Begin Menu -->
		<a class="navbar-brand" href="index.html">
            <img src="imagr/planet-earth.png" alt="logo">
            </a>
		<ul class="navbar-nav ml-auto">
			<li class="nav-item active">
			<a class="nav-link" href="propos.html">A propos <span class="sr-only">(current)</span></a>
			</li>
			
			<style>
        
      </style>
		</ul>
		<!-- End Menu -->
		<!-- Begin Search -->
		<form class="form-inline my-2 my-lg-0">
			<input class="form-control mr-sm-2" type="text" placeholder="Search">
			<span class="search-icon"><svg class="svgIcon-use" width="25" height="25" viewbox="0 0 25 25"><path d="M20.067 18.933l-4.157-4.157a6 6 0 1 0-.884.884l4.157 4.157a.624.624 0 1 0 .884-.884zM6.5 11c0-2.62 2.13-4.75 4.75-4.75S16 8.38 16 11s-2.13 4.75-4.75 4.75S6.5 13.62 6.5 11z"></path></svg></span>
		</form>
		<!-- End Search -->
	</div>
</div>
</nav>
<!-- End Nav
================================================== -->

<!-- Begin Article
================================================== -->
<div class="container">
	<div class="row">

		<!-- Begin Fixed Left Share -->
		<div class="col-md-2 col-xs-12">
			
		</div>
		<!-- End Fixed Left Share -->

		<!-- Begin Post -->
		<div class="col-md-8 col-md-offset-2 col-xs-12">
			<div class="mainheading">

				<!-- Begin Top Meta -->
				
				<!-- End Top Menta -->

				<h1 class="posttitle">Isochrone avec l'api openrouteserivce et Plotly </h1>
			</div>
            <div class="after-post-tags">
				<ul class="tags">
					<li><a href="#">Python</a></li>
					<li><a href="#">Geocodage</a></li>
					<li><a href="#">API</a></li>
					<li><a href="#">Geopandas</a></li>

				</ul>
			</div>

			<!-- Begin Featured Image -->
            <p>
La librairie Nominatim renvoie les coordonnées d'une ville. Ces coordonnées servent à alimenter la requête faite à l'api d'openrouteserivce. La réponse sous format json est ensuite utilisée pour générer une carte avec Plotly.            </p>
			<!-- Begin Featured Image -->
			<iframe src="iso.html"scrolling="no"frameBorder="0" width="100%" height="70%"title=""></iframe>
			<!-- End Featured Image -->
     
			<!-- End Featured Image -->

			<!-- Begin Post Content -->
                
				<pre><code class="python">import requests
import geopandas as gpd
from geopy.geocoders import Nominatim
import plotly.graph_objects as go
import json

def iso(ville):
    nom = ville
    geolocator = Nominatim(user_agent="myapplication")
    location = geolocator.geocode(nom)
    text = [i for i in location]
    coord = text[-1]
    loc = [[coord[1], coord[0]]]
    temp = [10, 20, 30, 40, 50]
    dist = [i * 60 for i in temp]
    dist = sorted(dist)
    body = {"locations": loc, "range": dist}
    family = '-apple-system,system-ui,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif'
    headers = {
    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',
    'Authorization': '5b3ce3597851110001cf6248df22650771d94c06a73d6fb78ba4706b',
    'Content-Type': 'application/json; charset=utf-8'
    }
    call = requests.post('https://api.openrouteservice.org/v2/isochrones/driving-car', json=body, headers=headers)
    call = call.json()
    gdf = gpd.GeoDataFrame.from_features(call["features"])

    for i, j in zip(range((len(dist) - 1), -1, -1), range((len(dist) - 2), -1, -1)):
        gdf["geometry"][i] = gdf["geometry"][i].difference(gdf["geometry"][j])
    kek = gdf.to_json()
    kek = json.loads(kek)
    gdf["min"] = [i / 60 for i in gdf["value"]]
    tok = open(".mapbox_token.txt").read()
    color = [
        "rgb(24, 78, 119)",
        "rgb(26, 117, 159)",
        "rgb(52, 160, 164)",
        "rgb(109, 196, 149)",
        "rgb(169, 222, 142)",
    ]
    
    fig = go.Figure(
        data=[
            go.Choroplethmapbox(
                geojson=kek,
                locations=gdf.index,
                z=gdf["min"].astype(float),
                colorscale=[
                    [0, color[0]],
                    [0.1, color[0]],
                    [0.1, color[0]],
                    [0.2, color[0]],
                    [0.2, color[1]],
                    [0.3, color[1]],
                    [0.3, color[1]],
                    [0.4, color[1]],
                    [0.4, color[2]],
                    [0.5, color[2]],
                    [0.5, color[2]],
                    [0.6, color[2]],
                    [0.6, color[3]],
                    [0.7, color[3]],
                    [0.7, color[3]],
                    [0.8, color[3]],
                    [0.8, color[4]],
                    [0.9, color[4]],
                    [0.9, color[4]],
                    [1.0, color[4]],
                ],
                colorbar=dict(tick0=0, dtick=10),
            )
        ]
    )

    fig.update_layout(
        height=550,
        title_x=0.5,
        title_y=0.93,
        font=dict(
            size=15,
            family=family,
        ),
        mapbox=dict(
            center=dict(lat=gdf["center"][0][1], lon=gdf["center"][0][0]),
            accesstoken=tok,
            zoom=8.4,
            style="streets",
        ),
    )

    fig.update_traces(
        colorbar_len=0.35,
        colorbar_orientation="h",
        marker_opacity=0.7,
        marker_line_width=0.2,
        hoverlabel_bgcolor="white",
        hoverinfo="z",
        hovertemplate="<extra></extra>%{z} minutes",
        colorbar_thickness=15,
        colorbar_y=0.07,
        colorbar_x=0.8075,
        colorbar_outlinewidth=0,
        colorbar_bgcolor="rgba(255,255,255,0.8)",
        colorbar_tickfont=dict(family=family, size=12, color="gray"),
        colorbar_title_side="top",
        colorbar_title_text="<b>Trajets en voiture (minutes)",
        colorbar_title_font=dict(family=family, color="rgb(100,100,100)", size=13),
        colorbar_ticklabelposition="outside bottom",
    )
    fig.update_layout(margin={"r": 0, "l": 0, "b": 0, "t": 0})
    fig.write_image(f"C:/Users/Florian/Desktop/AASITE/public_html/imagr/iso.svg")
    fig.update_layout(margin={"r": 0, "l": 0, "b": 0, "t": 90})
    fig.update_layout(
        {
            "plot_bgcolor": "#fcfcfc",
            "paper_bgcolor": "#fcfcfc",
        },
        title_text=f"<b>Isochrone de {ville}",
        height=700,
        coloraxis_colorbar_y=-1,
    )
    fig.write_html(
        f"C:/Users/Florian/Desktop/AASITE/public_html/iso.html",
        config={"displayModeBar": False},
    )

    return fig


iso("Pau")
</code></pre>
<br>

			<!-- End Post Content -->

			<!-- Begin Tags -->

			<!-- End Tags -->

		</div>
		<!-- End Post -->

	</div>
</div>
<!-- End Article
================================================== -->



<!-- Begin Related
================================================== -->


<!-- Begin Twitter Timeline
================================================== -->

<!-- End Twitter Timeline
================================================== -->

<!-- Begin AlertBar
================================================== -->

<!-- End AlertBar
================================================== -->

<!-- Begin Footer
================================================== -->
<!-- End Footer
================================================== -->

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="assets/js/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/ie10-viewport-bug-workaround.js"></script>
<script src="assets/js/mediumish.js"></script>
</body>
</html>
