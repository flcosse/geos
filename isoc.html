<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="auteur" content="">
<link rel="icon" href="imagr/planet-earth.png">
<title>API openrouteserivce</title>
<!-- Bootstrap core CSS -->
<link href="assets/css/bootstrap.min.css" rel="stylesheet">
<!-- Fonts -->

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
<!-- Custom styles for this template -->
<link href="assets/css/mediumish.css" rel="stylesheet">
</head>
<body>
    <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/atom-one-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/python.min.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>

    </head>
    
    
    <body>

	
		
	</body>
<style>
	
</style>
<!-- Begin Nav
================================================== -->
<nav class="navbar navbar-toggleable-md navbar-light bg-white fixed-top mediumnavigation">
<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
<div class="container">
	<!-- Begin Logo -->
	<a class="navbar-brand" href="index.html">
	
	</a>
	<!-- End Logo -->
	<div class="collapse navbar-collapse" id="navbarsExampleDefault">
		<!-- Begin Menu -->
		<a class="navbar-brand" href="index.html">
            <img src="imagr/planet-earth.png" alt="logo">
            </a>
		<ul class="navbar-nav ml-auto">
			<li class="nav-item active">
			<a class="nav-link" href="propos.html">A propos <span class="sr-only">(current)</span></a>
			</li>
			
			<style>
        
      </style>
		</ul>
		<!-- End Menu -->
		<!-- Begin Search -->
		<form class="form-inline my-2 my-lg-0">
			<input class="form-control mr-sm-2" type="text" placeholder="Search">
			<span class="search-icon"><svg class="svgIcon-use" width="25" height="25" viewbox="0 0 25 25"><path d="M20.067 18.933l-4.157-4.157a6 6 0 1 0-.884.884l4.157 4.157a.624.624 0 1 0 .884-.884zM6.5 11c0-2.62 2.13-4.75 4.75-4.75S16 8.38 16 11s-2.13 4.75-4.75 4.75S6.5 13.62 6.5 11z"></path></svg></span>
		</form>
		<!-- End Search -->
	</div>
</div>
</nav>
<!-- End Nav
================================================== -->

<!-- Begin Article
================================================== -->
<div class="container">
	<div class="row">

		<!-- Begin Fixed Left Share -->
		<div class="col-md-2 col-xs-12">
			
		</div>
		<!-- End Fixed Left Share -->

		<!-- Begin Post -->
		<div class="col-md-8 col-md-offset-2 col-xs-12">
			<div class="mainheading">

				<!-- Begin Top Meta -->
				
				<!-- End Top Menta -->

				<h1 class="posttitle">Cartographie isochrone avec Folium et l'api openrouteserivce</h1>
			</div>
            <div class="after-post-tags">
				<ul class="tags">
					<li><a href="#">Python</a></li>
					<li><a href="#">Geocodage</a></li>
					<li><a href="#">API</a></li>
					<li><a href="#">Geopandas</a></li>
                    <li><a href="#">Folium</a></li>

				</ul>
			</div>

			<!-- Begin Featured Image -->
            <p>
La librairie Nominatim renvoie les coordonnées d'une ville. Ces coordonnées servent à alimenter la requête faite à l'api d'openrouteserivce. La réponse sous format json est ensuite utilisée pour générer une carte avec Folium.            </p>
			<!-- Begin Featured Image -->
			<iframe src="iso.html"scrolling="no"frameBorder="0" width="100%" height="70%"title="" style="margin-bottom: -2%;"></iframe>
			<!-- End Featured Image -->
     
			<!-- End Featured Image -->

			<!-- Begin Post Content -->
                
				<pre><code class="python">import requests
import folium
import geopandas as gpd
from folium.plugins import MeasureControl
from folium.plugins import FloatImage
from geopy.geocoders import Nominatim
import branca.colormap as cm
from branca.element import Template, MacroElement


def iso(ville):
    nom = ville
    geolocator = Nominatim(user_agent="myapplication")
    location = geolocator.geocode(nom)
    text = [i for i in location]
    coord = text[-1]
    loc = [[coord[1], coord[0]]]
    temp = [5, 20, 35, 45,60]
    dist = [i * 60 for i in temp]
    dist = sorted(dist)
    body = {"locations": loc, "range": dist}

    headers = {
    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',
    'Authorization': '5b3ce3597851110001cf6248df22650771d94c06a73d6fb78ba4706b',
    'Content-Type': 'application/json; charset=utf-8'
    }
    call = requests.post('https://api.openrouteservice.org/v2/isochrones/driving-car', json=body, headers=headers)
    call = call.json()
    attr = '&copy; &lt;a href="https://www.maptiler.com/copyright//"&gt;MapTiler&lt;/a&gt;,  &lt;a href="https://openrouteservice.org/"&gt;Openrouteservice&lt;/a&gt;&copy; &lt;a href="https://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors'	
    tiles = (
        "https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=SBvS5B6Sbe35DQBbJflS"
    )
    m = folium.Map(
        location=[loc[0][-1], loc[0][0]], height="85%", control_scale=True, tiles=None,zoom_start=9
    )
    folium.TileLayer(tiles, control=True, attr=attr, show=True).add_to(m)
    gdf = gpd.GeoDataFrame.from_features(call["features"])

    for i, j in zip(range((len(dist) - 1), -1, -1), range((len(dist) - 2), -1, -1)):
        gdf["geometry"][i] = gdf["geometry"][i].difference(gdf["geometry"][j])

    color = ["SeaGreen", "YellowGreen", "gold", "darkorange", "red"]
    op = 0.5

    folium.Marker(
        location=[loc[0][-1], loc[0][0]],
        tooltip=f"Départ&lt;br&gt;Latitude : {round(coord[1], 3)}&lt;br&gt;Longitude : {round(coord[0], 3)}",
        icon=folium.Icon(color="black", icon="circle", prefix="fa"),
    ).add_to(m)

    lay = [
        folium.FeatureGroup(name=f"{int(dist[i]/60)} minutes en voiture")
        for i in range(len(dist))
    ]

    for i in range(len(dist)):
        lay[i].add_child(
            folium.GeoJson(
                gdf["geometry"][i],
                tooltip=f"{int(dist[i]/60)}",
                style_function=lambda x, fillColor=color[i], color=color[
                    i
                ], fillOpacity=op, weight=1: {
                    "fillColor": color,
                    "color": color,
                    "fillOpacity": op,
                    "weight": weight,
                },
            )
        )

    for i in lay:
        m.add_child(i)

    
    loc = f"Isochrone de {nom}"
    title_html = f"""
                 &lt;h3 align="center" style="font-size:22px"&gt;&lt;b&gt;{loc}&lt;/b&gt;&lt;/h3&gt;
                 """

    for i in range((len(dist) - 1), 0 - 1, -1):
        m.keep_in_front(lay[i])

    test = [i / 60 for i in dist]

    m.add_child(MeasureControl())
    m.get_root().html.add_child(folium.Element(title_html))
    m.fit_bounds(
        [
            gdf.total_bounds[1],
            gdf.total_bounds[0],
            gdf.total_bounds[-1],
            gdf.total_bounds[2],
        ]
    )
    template = """
{% macro html(this, kwargs) %}

  &lt;link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"&gt;

  &lt;script src="https://code.jquery.com/jquery-1.12.4.js"&gt;&lt;/script&gt;
  &lt;script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"&gt;&lt;/script&gt;
  

&lt;/head&gt;
&lt;body&gt;

 
&lt;div id='maplegend' class='maplegend' 
    style='filter: drop-shadow(0 0 5px rgb(218, 218, 218));position: absolute;margin-bottom:10%; z-index:999; background-color:rgba(255, 255, 255, 0.8);
     border-radius:0px; padding: 10px; font-size:14px; right: 20px; bottom: 20px;'&gt;
     
&lt;div class='legend-title'&gt;Déplacements en&lt;br&gt;voiture (minutes)&lt;/div&gt;
&lt;div class='legend-scale'&gt;
  &lt;ul class='legend-labels'&gt;
    &lt;li&gt;&lt;span style='background:seagreen;opacity:0.6;'&gt;&lt;/span&gt;10&lt;/li&gt;
    &lt;li&gt;&lt;span style='background:yellowgreen;opacity:0.6;'&gt;&lt;/span&gt;15&lt;/li&gt;
    &lt;li&gt;&lt;span style='background:gold;opacity:0.6;'&gt;&lt;/span&gt;25&lt;/li&gt;
    &lt;li&gt;&lt;span style='background:darkorange;opacity:0.6;'&gt;&lt;/span&gt;40&lt;/li&gt;
    &lt;li&gt;&lt;span style='background:red;opacity:0.6;'&gt;&lt;/span&gt;60&lt;/li&gt;
    

  &lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
 
&lt;/body&gt;
&lt;/html&gt;

&lt;style type='text/css'&gt;
  .maplegend .legend-title {
    text-align: left;
    margin-bottom: 5px;
    font-weight: bold;
    font-size: 90%;
    }
  .maplegend .legend-scale ul {
    margin: 0;
    margin-bottom: 5px;
    padding: 0;
    float: left;
    list-style: none;
    }
  .maplegend .legend-scale ul li {
    font-size: 80%;
    list-style: none;
    margin-left: 0;
    line-height: 18px;
    margin-bottom: 2px;
    }
  .maplegend ul.legend-labels li span {
    display: block;
    float: left;
    height: 16px;
    width: 30px;
    margin-right: 5px;
    margin-left: 0;
    }
  .maplegend .legend-source {
    font-size: 80%;
    color: #777;
    clear: both;
    }
  .maplegend a {
    color: #777;
    }
&lt;/style&gt;
{% endmacro %}"""

    macro = MacroElement()
    macro._template = Template(template)

    m.get_root().add_child(macro)
    m.save(outfile="C:/Users/Florian/Desktop/AASITE/public_html/iso.html")
    return m


iso("Bordeaux")

</code></pre>
<br>

			<!-- End Post Content -->

			<!-- Begin Tags -->

			<!-- End Tags -->

		</div>
		<!-- End Post -->

	</div>
</div>
<!-- End Article
================================================== -->



<!-- Begin Related
================================================== -->


<!-- Begin Twitter Timeline
================================================== -->

<!-- End Twitter Timeline
================================================== -->

<!-- Begin AlertBar
================================================== -->

<!-- End AlertBar
================================================== -->

<!-- Begin Footer
================================================== -->
<!-- End Footer
================================================== -->

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="assets/js/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/ie10-viewport-bug-workaround.js"></script>
<script src="assets/js/mediumish.js"></script>
</body>
</html>
