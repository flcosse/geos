<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="auteur" content="">
<link rel="icon" href="imagr/planet-earth.png">
<title>API openrouteserivce</title>
<!-- Bootstrap core CSS -->
<link href="assets/css/bootstrap.min.css" rel="stylesheet">
<!-- Fonts -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
<!-- Custom styles for this template -->
<link href="assets/css/mediumish.css" rel="stylesheet">
</head>
<body>
	<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/themes/prism.min.css"
    />
    </head>
    
    
    <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/prism.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-python.min.js"></script>
	
		
	</body>
<style>
	
</style>
<!-- Begin Nav
================================================== -->
<nav class="navbar navbar-toggleable-md navbar-light bg-white fixed-top mediumnavigation">
<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
<div class="container">
	<!-- Begin Logo -->
	<a class="navbar-brand" href="index.html">
	
	</a>
	<!-- End Logo -->
	<div class="collapse navbar-collapse" id="navbarsExampleDefault">
		<!-- Begin Menu -->
		<a class="navbar-brand" href="index.html">
            <img src="imagr/home.png" alt="logo">
            </a>
		<ul class="navbar-nav ml-auto">
			<li class="nav-item active">
			<a class="nav-link" href="index.html">Accueil <span class="sr-only">(current)</span></a>
			</li>
			
			
		</ul>
		<!-- End Menu -->
		<!-- Begin Search -->
		<form class="form-inline my-2 my-lg-0">
			<input class="form-control mr-sm-2" type="text" placeholder="Search">
			<span class="search-icon"><svg class="svgIcon-use" width="25" height="25" viewbox="0 0 25 25"><path d="M20.067 18.933l-4.157-4.157a6 6 0 1 0-.884.884l4.157 4.157a.624.624 0 1 0 .884-.884zM6.5 11c0-2.62 2.13-4.75 4.75-4.75S16 8.38 16 11s-2.13 4.75-4.75 4.75S6.5 13.62 6.5 11z"></path></svg></span>
		</form>
		<!-- End Search -->
	</div>
</div>
</nav>
<!-- End Nav
================================================== -->

<!-- Begin Article
================================================== -->
<div class="container">
	<div class="row">

		<!-- Begin Fixed Left Share -->
		<div class="col-md-2 col-xs-12">
			
		</div>
		<!-- End Fixed Left Share -->

		<!-- Begin Post -->
		<div class="col-md-8 col-md-offset-2 col-xs-12">
			<div class="mainheading">

				<!-- Begin Top Meta -->
				
				<!-- End Top Menta -->

				<h1 class="posttitle">Cartographie isochrone avec API</h1>
				
			</div>

			<!-- Begin Featured Image -->
			<iframe src="iso.html"scrolling="no"frameBorder="0" height="70%" width="150%" title="" style="margin-left: -24%"></iframe>
			<!-- End Featured Image -->
     
			<!-- End Featured Image -->

			<!-- Begin Post Content -->
			<div class="article-post">
				<pre><code class="language-python" style="font-size: 85%;">import requests
import folium
import json
import geopandas as gpd
from folium.plugins import MeasureControl
from folium.plugins import FloatImage
from geopy.geocoders import Nominatim

def iso(ville):
    nom = ville
    geolocator = Nominatim(user_agent='myapplication')
    location = geolocator.geocode(nom)
    text = [i for i in location]
    coord = text[-1]
    x = coord[0]
    y = coord[1]
    loc = [[y, x]]
    dist = [1200,1800,2400]
    dist = sorted(dist)
    body = {"locations": loc, "range": dist}
    lat = round(x, 3)
    lon = round(y, 3)
    
    headers = {
    'Accept': 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',
    'Authorization': '5b3ce3597851110001cf6248df22650771d94c06a73d6fb78ba4706b',
    'Content-Type': 'application/json; charset=utf-8'}
    
    call = requests.post("https://api.openrouteservice.org/v2/isochrones/driving-car",json=body,headers=headers,)
    call = call.json()
    
    tiles = "https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png"
    attr = 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    m = folium.Map(location=[loc[0][-1], loc[0][0]],height="90%", zoom_start=10,control_scale=True,tiles=None)
    folium.TileLayer(tiles, control=False,attr=attr).add_to(m)
    
    gdf = gpd.GeoDataFrame.from_features(call["features"])
    gdf["geometry"][1] = gdf["geometry"][1].difference(gdf["geometry"][0])
    gdf["geometry"][2] = gdf["geometry"][2].difference(gdf["geometry"][0])
    gdf["geometry"][2] = gdf["geometry"][2].difference(gdf["geometry"][1])
    
    color = ["YellowGreen", "#FDFF4B", "#FF4B4B"]
    op = 0.7

    folium.Marker(
        location=[loc[0][-1], loc[0][0]],
        tooltip=f"Latitude : {lat}<br>Longitude : {lon}",
        icon=folium.Icon(color="lightgray", icon="flag", prefix="fa"),
    ).add_to(m)
    
    lay = []
    for i in range(len(dist)):
        lay.append(folium.FeatureGroup(name=f"{int(dist[i]/60)} minutes en voiture"))
        
    for i in range(len(dist)):
        lay[i].add_child(
            folium.GeoJson(
                gdf["geometry"][i],
                style_function=lambda x, fillColor=color[i], color=color[i], fillOpacity=op, weight=0: {
                    "fillColor": color,
                    "color": color,
                    "fillOpacity": op,
                    "weight": weight,
                },
            )
        )

    
    for i in lay:
        m.add_child(i)
        
    m.add_child(MeasureControl())
    url = "https://media.licdn.com/mpr/mpr/shrinknp_100_100/AAEAAQAAAAAAAAlgAAAAJGE3OTA4YTdlLTkzZjUtNDFjYy1iZThlLWQ5OTNkYzlhNzM4OQ.jpg"
    FloatImage(url, bottom=5, left=85).add_to(m)
    loc = f"Carte isochrone, centre :  {nom}"
    title_html = """
                 <h3 align="center" style="font-size:16px"><b>{}</b></h3>
                 """.format(
        loc
    )
    m.get_root().html.add_child(folium.Element(title_html))
    folium.map.LayerControl("topright", collapsed=True).add_to(m)
    m.save(outfile="C:/Users/Florian/Desktop/AASITE/public_html/iso.html")
    return m

iso("Tarbes")
</code></pre>
<br>

			<!-- End Post Content -->

			<!-- Begin Tags -->

			<!-- End Tags -->

		</div>
		<!-- End Post -->

	</div>
</div>
<!-- End Article
================================================== -->



<!-- Begin Related
================================================== -->


<!-- Begin Twitter Timeline
================================================== -->

<!-- End Twitter Timeline
================================================== -->

<!-- Begin AlertBar
================================================== -->

<!-- End AlertBar
================================================== -->

<!-- Begin Footer
================================================== -->
<!-- End Footer
================================================== -->

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="assets/js/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/ie10-viewport-bug-workaround.js"></script>
<script src="assets/js/mediumish.js"></script>
</body>
</html>
